{"version":3,"sources":["useCarouselController.tsx"],"names":["useCarouselController","opts","size","loop","handlerOffsetX","disable","originalLength","length","onChange","duration","index","sharedIndex","React","useRef","sharedPreIndex","convertToSharedIndex","useCallback","i","computedIndex","current","toInt","value","Math","abs","_sharedIndex","getCurrentIndex","canSliding","onScrollEnd","onScrollBegin","scrollWithTiming","toValue","callback","easing","Easing","easeOutQuart","isFinished","next","currentPage","round","prev","to","idx","animated","offset"],"mappings":"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","sourcesContent":["import React from 'react';\nimport type Animated from 'react-native-reanimated';\nimport { Easing } from '../constants';\nimport { runOnJS, useSharedValue, withTiming } from 'react-native-reanimated';\n\ninterface IOpts {\n    loop: boolean;\n    size: number;\n    handlerOffsetX: Animated.SharedValue<number>;\n    disable?: boolean;\n    duration?: number;\n    originalLength: number;\n    length: number;\n    onScrollBegin?: () => void;\n    onScrollEnd?: () => void;\n    // the length before fill data\n    onChange: (index: number) => void;\n}\n\nexport interface ICarouselController {\n    length: number;\n    index: Animated.SharedValue<number>;\n    sharedIndex: React.MutableRefObject<number>;\n    sharedPreIndex: React.MutableRefObject<number>;\n    prev: () => void;\n    next: () => void;\n    computedIndex: () => void;\n    getCurrentIndex: () => number;\n    to: (index: number, animated?: boolean) => void;\n}\n\nexport function useCarouselController(opts: IOpts): ICarouselController {\n    const {\n        size,\n        loop,\n        handlerOffsetX,\n        disable = false,\n        originalLength,\n        length,\n        onChange,\n        duration,\n    } = opts;\n\n    const index = useSharedValue<number>(0);\n    // The Index displayed to the user\n    const sharedIndex = React.useRef<number>(0);\n    const sharedPreIndex = React.useRef<number>(0);\n\n    const convertToSharedIndex = React.useCallback(\n        (i: number) => {\n            if (loop) {\n                switch (originalLength) {\n                    case 1:\n                        return 0;\n                    case 2:\n                        return i % 2;\n                }\n            }\n            return i;\n        },\n        [originalLength, loop]\n    );\n\n    const computedIndex = React.useCallback(() => {\n        sharedPreIndex.current = sharedIndex.current;\n        const toInt = (handlerOffsetX.value / size) % length;\n        const i =\n            handlerOffsetX.value <= 0\n                ? Math.abs(toInt)\n                : Math.abs(toInt > 0 ? length - toInt : 0);\n        index.value = i;\n        const _sharedIndex = convertToSharedIndex(i);\n        sharedIndex.current = _sharedIndex;\n        onChange(_sharedIndex);\n    }, [\n        length,\n        handlerOffsetX,\n        sharedPreIndex,\n        index,\n        size,\n        sharedIndex,\n        convertToSharedIndex,\n        onChange,\n    ]);\n\n    const getCurrentIndex = React.useCallback(() => {\n        return index.value;\n    }, [index]);\n\n    const canSliding = React.useCallback(() => {\n        return !disable;\n    }, [disable]);\n\n    const onScrollEnd = React.useCallback(() => {\n        opts.onScrollEnd?.();\n    }, [opts]);\n\n    const onScrollBegin = React.useCallback(() => {\n        opts.onScrollBegin?.();\n    }, [opts]);\n\n    const scrollWithTiming = React.useCallback(\n        (toValue: number, callback?: () => void) => {\n            return withTiming(\n                toValue,\n                { duration, easing: Easing.easeOutQuart },\n                (isFinished: boolean) => {\n                    callback?.();\n                    if (isFinished) {\n                        runOnJS(onScrollEnd)();\n                    }\n                }\n            );\n        },\n        [onScrollEnd, duration]\n    );\n\n    const next = React.useCallback(() => {\n        if (!canSliding() || (!loop && index.value === length - 1)) return;\n\n        onScrollBegin?.();\n\n        const currentPage = Math.round(handlerOffsetX.value / size);\n\n        handlerOffsetX.value = scrollWithTiming((currentPage - 1) * size);\n    }, [\n        canSliding,\n        loop,\n        index.value,\n        length,\n        onScrollBegin,\n        handlerOffsetX,\n        size,\n        scrollWithTiming,\n    ]);\n\n    const prev = React.useCallback(() => {\n        if (!canSliding() || (!loop && index.value === 0)) return;\n\n        onScrollBegin?.();\n\n        const currentPage = Math.round(handlerOffsetX.value / size);\n\n        handlerOffsetX.value = scrollWithTiming((currentPage + 1) * size);\n    }, [\n        canSliding,\n        loop,\n        index.value,\n        onScrollBegin,\n        handlerOffsetX,\n        size,\n        scrollWithTiming,\n    ]);\n\n    const to = React.useCallback(\n        (idx: number, animated: boolean = false) => {\n            if (idx === index.value) return;\n            if (!canSliding()) return;\n\n            onScrollBegin?.();\n\n            const offset = handlerOffsetX.value + (index.value - idx) * size;\n\n            if (animated) {\n                handlerOffsetX.value = scrollWithTiming(offset, () => {\n                    index.value = idx;\n                });\n            } else {\n                handlerOffsetX.value = offset;\n                index.value = idx;\n                runOnJS(onScrollEnd)();\n            }\n        },\n        [\n            index,\n            canSliding,\n            onScrollBegin,\n            handlerOffsetX,\n            size,\n            scrollWithTiming,\n            onScrollEnd,\n        ]\n    );\n\n    return {\n        next,\n        prev,\n        to,\n        index,\n        length,\n        sharedIndex,\n        sharedPreIndex,\n        computedIndex,\n        getCurrentIndex,\n    };\n}\n"]}