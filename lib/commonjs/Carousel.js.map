{"version":3,"sources":["Carousel.tsx"],"names":["Carousel","_props","ref","props","data","loop","mode","style","width","height","vertical","autoPlay","autoPlayDelay","windowSize","autoPlayReverse","autoPlayInterval","renderItem","onScrollEnd","onSnapToItem","onScrollBegin","onProgressChange","customAnimation","commonVariables","size","handlerOffsetX","offsetX","totalSize","length","x","value","isNaN","carouselController","disable","originalLength","_onScrollEnd","onChange","i","duration","next","prev","sharedPreIndex","sharedIndex","computedIndex","getCurrentIndex","run","pause","scrollViewGestureOnScrollBegin","React","useCallback","current","scrollViewGestureOnScrollEnd","goToIndex","animated","to","useImperativeHandle","visibleRanges","total","viewSize","translation","layoutConfig","renderLayout","item","realIndex","DATA_LENGTH","SINGLE_ITEM","DOUBLE_ITEM","animationValue","index","common","styles","container","itemsVertical","itemsHorizontal","map","forwardRef","StyleSheet","create","overflow","flexDirection"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;AAGA,SAASA,QAAT,CACIC,MADJ,EAEIC,GAFJ,EAGE;AACE,QAAMC,KAAK,GAAG,gCAAaF,MAAb,CAAd;AAEA,QAAM;AACFG,IAAAA,IADE;AAEFC,IAAAA,IAFE;AAGFC,IAAAA,IAHE;AAIFC,IAAAA,KAJE;AAKFC,IAAAA,KALE;AAMFC,IAAAA,MANE;AAOFC,IAAAA,QAPE;AAQFC,IAAAA,QARE;AASFC,IAAAA,aAAa,GAAG,IATd;AAUFC,IAAAA,UAVE;AAWFC,IAAAA,eAXE;AAYFC,IAAAA,gBAZE;AAaFC,IAAAA,UAbE;AAcFC,IAAAA,WAdE;AAeFC,IAAAA,YAfE;AAgBFC,IAAAA,aAhBE;AAiBFC,IAAAA,gBAjBE;AAkBFC,IAAAA;AAlBE,MAmBFlB,KAnBJ;AAqBA,QAAMmB,eAAe,GAAG,4CAAmBnB,KAAnB,CAAxB;AACA,QAAM;AAAEoB,IAAAA,IAAF;AAAQC,IAAAA;AAAR,MAA2BF,eAAjC;AAEA,QAAMG,OAAO,GAAG,4CAAgB,MAAM;AAClC,UAAMC,SAAS,GAAGH,IAAI,GAAGnB,IAAI,CAACuB,MAA9B;AACA,UAAMC,CAAC,GAAGJ,cAAc,CAACK,KAAf,GAAuBH,SAAjC;;AAEA,QAAI,CAACrB,IAAL,EAAW;AACP,aAAOmB,cAAc,CAACK,KAAtB;AACH;;AACD,WAAOC,KAAK,CAACF,CAAD,CAAL,GAAW,CAAX,GAAeA,CAAtB;AACH,GARe,EAQb,CAACvB,IAAD,EAAOkB,IAAP,EAAanB,IAAb,CARa,CAAhB;AAUA,oDAAsBD,KAAtB;AACA,gDAAoB;AAAEoB,IAAAA,IAAF;AAAQE,IAAAA,OAAR;AAAiBrB,IAAAA,IAAjB;AAAuBgB,IAAAA;AAAvB,GAApB;AAEA,QAAMW,kBAAkB,GAAG,kDAAsB;AAC7C1B,IAAAA,IAD6C;AAE7CkB,IAAAA,IAF6C;AAG7CC,IAAAA,cAH6C;AAI7CG,IAAAA,MAAM,EAAEvB,IAAI,CAACuB,MAJgC;AAK7CK,IAAAA,OAAO,EAAE,CAAC5B,IAAI,CAACuB,MAL8B;AAM7CM,IAAAA,cAAc,EAAE7B,IAAI,CAACuB,MANwB;AAO7CV,IAAAA,WAAW,EAAE,MAAM,oCAAQiB,YAAR,GAP0B;AAQ7Cf,IAAAA,aAAa,EAAE,MAAM,CAAC,CAACA,aAAF,IAAmB,oCAAQA,aAAR,GARK;AAS7CgB,IAAAA,QAAQ,EAAGC,CAAD,IAAOlB,YAAY,IAAI,oCAAQA,YAAR,EAAsBkB,CAAtB,CATY;AAU7CC,IAAAA,QAAQ,EAAEtB;AAVmC,GAAtB,CAA3B;AAaA,QAAM;AACFuB,IAAAA,IADE;AAEFC,IAAAA,IAFE;AAGFC,IAAAA,cAHE;AAIFC,IAAAA,WAJE;AAKFC,IAAAA,aALE;AAMFC,IAAAA;AANE,MAOFZ,kBAPJ;AASA,QAAM;AAAEa,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAiB,8BAAY;AAC/BlC,IAAAA,QAD+B;AAE/BI,IAAAA,gBAF+B;AAG/BD,IAAAA,eAH+B;AAI/BiB,IAAAA,kBAJ+B;AAK/BnB,IAAAA;AAL+B,GAAZ,CAAvB;;AAQA,QAAMkC,8BAA8B,GAAGC,eAAMC,WAAN,CAAkB,MAAM;AAC3DH,IAAAA,KAAK;AACL1B,IAAAA,aAAa,SAAb,IAAAA,aAAa,WAAb,YAAAA,aAAa;AAChB,GAHsC,EAGpC,CAACA,aAAD,EAAgB0B,KAAhB,CAHoC,CAAvC;;AAKA,QAAMX,YAAY,GAAGa,eAAMC,WAAN,CAAkB,MAAM;AACzCN,IAAAA,aAAa;AACbzB,IAAAA,WAAW,SAAX,IAAAA,WAAW,WAAX,YAAAA,WAAW,CAAGuB,cAAc,CAACS,OAAlB,EAA2BR,WAAW,CAACQ,OAAvC,CAAX;AACH,GAHoB,EAGlB,CAACT,cAAD,EAAiBC,WAAjB,EAA8BC,aAA9B,EAA6CzB,WAA7C,CAHkB,CAArB;;AAKA,QAAMiC,4BAA4B,GAAGH,eAAMC,WAAN,CAAkB,MAAM;AACzDJ,IAAAA,GAAG;;AACHV,IAAAA,YAAY;AACf,GAHoC,EAGlC,CAACA,YAAD,EAAeU,GAAf,CAHkC,CAArC;;AAKA,QAAMO,SAAS,GAAGJ,eAAMC,WAAN,CACd,CAACZ,CAAD,EAAYgB,QAAZ,KAAmC;AAC/BrB,IAAAA,kBAAkB,CAACsB,EAAnB,CAAsBjB,CAAtB,EAAyBgB,QAAzB;AACH,GAHa,EAId,CAACrB,kBAAD,CAJc,CAAlB;;AAOAgB,iBAAMO,mBAAN,CACIpD,GADJ,EAEI,OAAO;AACHoC,IAAAA,IADG;AAEHC,IAAAA,IAFG;AAGHI,IAAAA,eAHG;AAIHQ,IAAAA;AAJG,GAAP,CAFJ,EAQI,CAACR,eAAD,EAAkBQ,SAAlB,EAA6Bb,IAA7B,EAAmCC,IAAnC,CARJ;;AAWA,QAAMgB,aAAa,GAAG,wCAAiB;AACnCC,IAAAA,KAAK,EAAEpD,IAAI,CAACuB,MADuB;AAEnC8B,IAAAA,QAAQ,EAAElC,IAFyB;AAGnCmC,IAAAA,WAAW,EAAElC,cAHsB;AAInCX,IAAAA;AAJmC,GAAjB,CAAtB;AAOA,QAAM8C,YAAY,GAAG,sCAAmB,EAAE,GAAGxD,KAAL;AAAYoB,IAAAA;AAAZ,GAAnB,CAArB;;AAEA,QAAMqC,YAAY,GAAGb,eAAMC,WAAN,CACjB,CAACa,IAAD,EAAUzB,CAAV,KAAwB;AACpB,QAAI0B,SAAS,GAAG1B,CAAhB;;AACA,QAAIhC,IAAI,CAACuB,MAAL,KAAgBoC,uBAAYC,WAAhC,EAA6C;AACzCF,MAAAA,SAAS,GAAG1B,CAAC,GAAG,CAAhB;AACH;;AAED,QAAIhC,IAAI,CAACuB,MAAL,KAAgBoC,uBAAYE,WAAhC,EAA6C;AACzCH,MAAAA,SAAS,GAAG1B,CAAC,GAAG,CAAhB;AACH;;AAED,wBACI,6BAAC,sBAAD;AACI,MAAA,GAAG,EAAEA,CADT;AAEI,MAAA,KAAK,EAAEA,CAFX;AAGI,MAAA,cAAc,EAAEX,OAHpB;AAII,MAAA,aAAa,EAAE8B,aAJnB;AAKI,MAAA,cAAc,EAAElC,eAAe,IAAIsC;AALvC,OAOK,CAAC;AAAEO,MAAAA;AAAF,KAAD,KACGlD,UAAU,CAAC;AACP6C,MAAAA,IADO;AAEPM,MAAAA,KAAK,EAAEL,SAFA;AAGPI,MAAAA;AAHO,KAAD,CARlB,CADJ;AAiBH,GA5BgB,EA6BjB,CACI9D,IADJ,EAEIqB,OAFJ,EAGI8B,aAHJ,EAIIvC,UAJJ,EAKI2C,YALJ,EAMItC,eANJ,CA7BiB,CAArB;;AAuCA,sBACI,6BAAC,UAAD,CAAK,QAAL;AAAc,IAAA,KAAK,EAAE;AAAElB,MAAAA,KAAF;AAASiE,MAAAA,MAAM,EAAE9C;AAAjB;AAArB,kBACI,6BAAC,iBAAD;AACI,IAAA,KAAK,EAAE,CACH+C,MAAM,CAACC,SADJ,EAEH;AAAE9D,MAAAA,KAAK,EAAEA,KAAK,IAAI,MAAlB;AAA0BC,MAAAA,MAAM,EAAEA,MAAM,IAAI;AAA5C,KAFG,EAGHF,KAHG;AADX,kBAOI,6BAAC,oCAAD;AACI,IAAA,IAAI,EAAEgB,IADV;AAEI,IAAA,WAAW,EAAEC,cAFjB;AAGI,IAAA,aAAa,EAAEsB,8BAHnB;AAII,IAAA,WAAW,EAAEI;AAJjB,kBAMI,6BAAC,8BAAD,CAAU,IAAV;AACI,IAAA,GAAG,EAAE5C,IADT;AAEI,IAAA,KAAK,EAAE,CACH+D,MAAM,CAACC,SADJ,EAEH;AACI9D,MAAAA,KAAK,EAAEA,KAAK,IAAI,MADpB;AAEIC,MAAAA,MAAM,EAAEA,MAAM,IAAI;AAFtB,KAFG,EAMHF,KANG,EAOHG,QAAQ,GACF2D,MAAM,CAACE,aADL,GAEFF,MAAM,CAACG,eATV;AAFX,KAcKpE,IAAI,CAACqE,GAAL,CAASb,YAAT,CAdL,CANJ,CAPJ,CADJ,CADJ;AAmCH;;4BAEcb,eAAM2B,UAAN,CAAiB1E,QAAjB,C;;;;AAEf,MAAMqE,MAAM,GAAGM,wBAAWC,MAAX,CAAkB;AAC7BN,EAAAA,SAAS,EAAE;AACPO,IAAAA,QAAQ,EAAE;AADH,GADkB;AAI7BL,EAAAA,eAAe,EAAE;AACbM,IAAAA,aAAa,EAAE;AADF,GAJY;AAO7BP,EAAAA,aAAa,EAAE;AACXO,IAAAA,aAAa,EAAE;AADJ;AAPc,CAAlB,CAAf","sourcesContent":["import React, { PropsWithChildren } from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport Animated, { runOnJS, useDerivedValue } from 'react-native-reanimated';\nimport { DATA_LENGTH } from './constants';\nimport { useAutoPlay } from './hooks/useAutoPlay';\nimport { useCarouselController } from './hooks/useCarouselController';\nimport { useCommonVariables } from './hooks/useCommonVariables';\nimport { useInitProps } from './hooks/useInitProps';\nimport { useLayoutConfig } from './hooks/useLayoutConfig';\nimport { useOnProgressChange } from './hooks/useOnProgressChange';\nimport { usePropsErrorBoundary } from './hooks/usePropsErrorBoundary';\nimport { useVisibleRanges } from './hooks/useVisibleRanges';\nimport { BaseLayout } from './layouts/BaseLayout';\nimport { ScrollViewGesture } from './ScrollViewGesture';\nimport { CTX } from './store';\nimport type { ICarouselInstance, TCarouselProps } from './types';\n\nfunction Carousel<T>(\n    _props: PropsWithChildren<TCarouselProps<T>>,\n    ref: React.Ref<ICarouselInstance>\n) {\n    const props = useInitProps(_props);\n\n    const {\n        data,\n        loop,\n        mode,\n        style,\n        width,\n        height,\n        vertical,\n        autoPlay,\n        autoPlayDelay = 5000,\n        windowSize,\n        autoPlayReverse,\n        autoPlayInterval,\n        renderItem,\n        onScrollEnd,\n        onSnapToItem,\n        onScrollBegin,\n        onProgressChange,\n        customAnimation,\n    } = props;\n\n    const commonVariables = useCommonVariables(props);\n    const { size, handlerOffsetX } = commonVariables;\n\n    const offsetX = useDerivedValue(() => {\n        const totalSize = size * data.length;\n        const x = handlerOffsetX.value % totalSize;\n\n        if (!loop) {\n            return handlerOffsetX.value;\n        }\n        return isNaN(x) ? 0 : x;\n    }, [loop, size, data]);\n\n    usePropsErrorBoundary(props);\n    useOnProgressChange({ size, offsetX, data, onProgressChange });\n\n    const carouselController = useCarouselController({\n        loop,\n        size,\n        handlerOffsetX,\n        length: data.length,\n        disable: !data.length,\n        originalLength: data.length,\n        onScrollEnd: () => runOnJS(_onScrollEnd)(),\n        onScrollBegin: () => !!onScrollBegin && runOnJS(onScrollBegin)(),\n        onChange: (i) => onSnapToItem && runOnJS(onSnapToItem)(i),\n        duration: autoPlayInterval,\n    });\n\n    const {\n        next,\n        prev,\n        sharedPreIndex,\n        sharedIndex,\n        computedIndex,\n        getCurrentIndex,\n    } = carouselController;\n\n    const { run, pause } = useAutoPlay({\n        autoPlay,\n        autoPlayInterval,\n        autoPlayReverse,\n        carouselController,\n        autoPlayDelay,\n    });\n\n    const scrollViewGestureOnScrollBegin = React.useCallback(() => {\n        pause();\n        onScrollBegin?.();\n    }, [onScrollBegin, pause]);\n\n    const _onScrollEnd = React.useCallback(() => {\n        computedIndex();\n        onScrollEnd?.(sharedPreIndex.current, sharedIndex.current);\n    }, [sharedPreIndex, sharedIndex, computedIndex, onScrollEnd]);\n\n    const scrollViewGestureOnScrollEnd = React.useCallback(() => {\n        run();\n        _onScrollEnd();\n    }, [_onScrollEnd, run]);\n\n    const goToIndex = React.useCallback(\n        (i: number, animated?: boolean) => {\n            carouselController.to(i, animated);\n        },\n        [carouselController]\n    );\n\n    React.useImperativeHandle(\n        ref,\n        () => ({\n            next,\n            prev,\n            getCurrentIndex,\n            goToIndex,\n        }),\n        [getCurrentIndex, goToIndex, next, prev]\n    );\n\n    const visibleRanges = useVisibleRanges({\n        total: data.length,\n        viewSize: size,\n        translation: handlerOffsetX,\n        windowSize,\n    });\n\n    const layoutConfig = useLayoutConfig<T>({ ...props, size });\n\n    const renderLayout = React.useCallback(\n        (item: T, i: number) => {\n            let realIndex = i;\n            if (data.length === DATA_LENGTH.SINGLE_ITEM) {\n                realIndex = i % 1;\n            }\n\n            if (data.length === DATA_LENGTH.DOUBLE_ITEM) {\n                realIndex = i % 2;\n            }\n\n            return (\n                <BaseLayout\n                    key={i}\n                    index={i}\n                    handlerOffsetX={offsetX}\n                    visibleRanges={visibleRanges}\n                    animationStyle={customAnimation || layoutConfig}\n                >\n                    {({ animationValue }) =>\n                        renderItem({\n                            item,\n                            index: realIndex,\n                            animationValue,\n                        })\n                    }\n                </BaseLayout>\n            );\n        },\n        [\n            data,\n            offsetX,\n            visibleRanges,\n            renderItem,\n            layoutConfig,\n            customAnimation,\n        ]\n    );\n\n    return (\n        <CTX.Provider value={{ props, common: commonVariables }}>\n            <View\n                style={[\n                    styles.container,\n                    { width: width || '100%', height: height || '100%' },\n                    style,\n                ]}\n            >\n                <ScrollViewGesture\n                    size={size}\n                    translation={handlerOffsetX}\n                    onScrollBegin={scrollViewGestureOnScrollBegin}\n                    onScrollEnd={scrollViewGestureOnScrollEnd}\n                >\n                    <Animated.View\n                        key={mode}\n                        style={[\n                            styles.container,\n                            {\n                                width: width || '100%',\n                                height: height || '100%',\n                            },\n                            style,\n                            vertical\n                                ? styles.itemsVertical\n                                : styles.itemsHorizontal,\n                        ]}\n                    >\n                        {data.map(renderLayout)}\n                    </Animated.View>\n                </ScrollViewGesture>\n            </View>\n        </CTX.Provider>\n    );\n}\n\nexport default React.forwardRef(Carousel) as typeof Carousel;\n\nconst styles = StyleSheet.create({\n    container: {\n        overflow: 'hidden',\n    },\n    itemsHorizontal: {\n        flexDirection: 'row',\n    },\n    itemsVertical: {\n        flexDirection: 'column',\n    },\n});\n"]}